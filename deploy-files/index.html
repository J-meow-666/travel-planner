<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…æ¸¸æ”»ç•¥å¹³å° - ä¸ªæ€§åŒ–æ—…è¡Œè®¡åˆ’å®šåˆ¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="AIæ™ºèƒ½æ—…æ¸¸æ”»ç•¥å¹³å°ï¼Œä¸ºæ‚¨å®šåˆ¶ä¸ªæ€§åŒ–æ—…è¡Œè®¡åˆ’ï¼Œæ”¯æŒå¤šè½®å¯¹è¯è°ƒæ•´è¡Œç¨‹">
    <meta name="keywords" content="æ—…æ¸¸æ”»ç•¥,AIæ—…è¡Œ,è¡Œç¨‹è§„åˆ’,ä¸ªæ€§åŒ–æ—…æ¸¸">
    <meta name="author" content="TravelPlanner">
    <meta property="og:title" content="AIæ—…æ¸¸æ”»ç•¥å¹³å° - ä¸ªæ€§åŒ–æ—…è¡Œè®¡åˆ’å®šåˆ¶">
    <meta property="og:description" content="è¾“å…¥ç›®çš„åœ°ï¼ŒAIä¸ºæ‚¨å®šåˆ¶ä¸“å±æ—…è¡Œè®¡åˆ’">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=AIæ—…æ¸¸æ”»ç•¥å¹³å°">
    <style>
        * { font-family: 'Microsoft YaHei', 'Inter', system-ui, sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { 
            background: white; 
            border-radius: 1rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #f3f4f6;
            overflow: hidden;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
            color: white; 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.5rem; 
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
        }
        .btn-primary:hover { 
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); 
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .input-field { 
            width: 100%; 
            padding: 0.75rem 1rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.5rem; 
            transition: all 0.2s;
            box-sizing: border-box;
        }
        .input-field:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .activity-card {
            background: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.2s;
        }
        .activity-card:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        .message-bubble {
            max-width: 80%;
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            word-wrap: break-word;
        }
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #6b7280;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .skeleton {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .online-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .feature-card {
            transition: transform 0.2s;
        }
        .feature-card:hover {
            transform: translateY(-2px);
        }
        .interest-btn {
            transition: all 0.2s;
        }
        .interest-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header with Online Badge -->
    <header class="bg-white shadow-sm border-b border-gray-100">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="gradient-bg p-2 rounded-lg">
                        <i class="fas fa-compass text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">æ—…æ¸¸æ”»ç•¥å¹³å°</h1>
                        <p class="text-xs text-gray-500 flex items-center">
                            <i class="fas fa-globe mr-1 text-green-500"></i>
                            AIæ™ºèƒ½å®šåˆ¶ Â· åœ¨çº¿ç‰ˆæœ¬
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="online-badge px-3 py-1 rounded-full text-white text-xs flex items-center">
                        <i class="fas fa-wifi mr-1"></i>
                        åœ¨çº¿è®¿é—®
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Online Banner -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 max-w-4xl mx-auto">
            <div class="flex items-center">
                <i class="fas fa-cloud text-green-600 mr-3"></i>
                <div>
                    <h3 class="text-green-800 font-semibold">ğŸ‰ æ¬¢è¿ä½¿ç”¨åœ¨çº¿ç‰ˆæœ¬</h3>
                    <p class="text-green-700 text-sm">AIæ—…æ¸¸æ”»ç•¥å¹³å°ç°å·²éƒ¨ç½²ä¸Šçº¿ï¼Œéšæ—¶éšåœ°è®¿é—®ä½¿ç”¨ã€‚å»ºè®®é¦–æ¬¡ä½¿ç”¨æ—¶é…ç½®æ‚¨çš„AI APIå¯†é’¥ã€‚</p>
                </div>
            </div>
        </div>

        <!-- åˆå§‹è¡¨å• -->
        <div id="initialForm" class="max-w-4xl mx-auto">
            <!-- Hero Section -->
            <div class="text-center mb-12">
                <div class="flex justify-center mb-6">
                    <div class="bg-blue-100 p-6 rounded-full animate-pulse">
                        <i class="fas fa-map-marked-alt text-5xl text-blue-600"></i>
                    </div>
                </div>
                <h1 class="text-5xl font-bold text-gray-900 mb-4">
                    AIæ—…æ¸¸æ”»ç•¥å¹³å°
                </h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-8">
                    è¾“å…¥æ‚¨çš„ç›®çš„åœ°ï¼ŒAIä¸ºæ‚¨å®šåˆ¶ä¸“å±æ—…è¡Œè®¡åˆ’ã€‚é€šè¿‡æ™ºèƒ½å¯¹è¯ï¼Œéšæ—¶è°ƒæ•´å®Œå–„æ‚¨çš„è¡Œç¨‹ã€‚
                </p>
                
                <!-- Features -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="text-center p-6 bg-white rounded-xl shadow-lg feature-card">
                        <i class="fas fa-magic text-3xl text-blue-600 mb-3"></i>
                        <h3 class="font-semibold text-gray-900 mb-2">æ™ºèƒ½è§„åˆ’</h3>
                        <p class="text-sm text-gray-600">åŸºäºæ‚¨çš„åå¥½å®šåˆ¶å®Œç¾è¡Œç¨‹</p>
                    </div>
                    <div class="text-center p-6 bg-white rounded-xl shadow-lg feature-card">
                        <i class="fas fa-comments text-3xl text-pink-600 mb-3"></i>
                        <h3 class="font-semibold text-gray-900 mb-2">å®æ—¶å¯¹è¯</h3>
                        <p class="text-sm text-gray-600">å¤šè½®äº’åŠ¨è°ƒæ•´æ—…è¡Œè®¡åˆ’</p>
                    </div>
                    <div class="text-center p-6 bg-white rounded-xl shadow-lg feature-card">
                        <i class="fas fa-cloud-upload-alt text-3xl text-green-600 mb-3"></i>
                        <h3 class="font-semibold text-gray-900 mb-2">äº‘ç«¯éƒ¨ç½²</h3>
                        <p class="text-sm text-gray-600">éšæ—¶éšåœ°è®¿é—®ä½¿ç”¨</p>
                    </div>
                </div>
            </div>

            <!-- APIé…ç½®åŒºåŸŸ -->
            <div class="card p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-cog mr-2 text-gray-600"></i>
                    AIé…ç½®ï¼ˆä¸€æ¬¡æ€§è®¾ç½®ï¼‰
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            APIå¯†é’¥ <span class="text-red-500">*</span>
                        </label>
                        <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„APIå¯†é’¥" class="input-field">
                        <p class="text-xs text-gray-500 mt-1">
                            <i class="fas fa-lock mr-1"></i>
                            å¯†é’¥å°†å®‰å…¨å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
                        </p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            APIç«¯ç‚¹
                        </label>
                        <input type="text" id="apiUrl" value="http://mgw.proxy.ksyun.com/v1/chat/completions" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            æ¨¡å‹åç§°
                        </label>
                        <input type="text" id="modelName" value="qwen3-coder-480b-a35b-instruct" class="input-field">
                    </div>
                    <button onclick="saveConfig()" class="btn-primary">
                        <i class="fas fa-save mr-2"></i>
                        ä¿å­˜é…ç½®
                    </button>
                    <button onclick="testConnection()" class="ml-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-plug mr-2"></i>
                        æµ‹è¯•è¿æ¥
                    </button>
                </div>
            </div>

            <!-- Destination Form -->
            <div class="card p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>
                    å¼€å§‹å®šåˆ¶æ‚¨çš„æ—…è¡Œè®¡åˆ’
                </h2>

                <div class="space-y-6">
                    <!-- ç›®çš„åœ°è¾“å…¥ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ç›®çš„åœ°
                        </label>
                        <input type="text" id="destination" placeholder="è¾“å…¥æ‚¨æƒ³å»çš„åŸå¸‚æˆ–åœ°åŒº" class="input-field">
                    </div>

                    <!-- æ—…è¡Œå¤©æ•° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar-alt mr-1"></i>
                            æ—…è¡Œå¤©æ•°
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="range" id="duration" min="1" max="14" value="3" class="flex-1">
                            <span id="durationDisplay" class="w-12 text-center font-medium bg-gray-100 px-2 py-1 rounded">3å¤©</span>
                        </div>
                    </div>

                    <!-- é¢„ç®—èŒƒå›´ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-dollar-sign mr-1"></i>
                            é¢„ç®—èŒƒå›´
                        </label>
                        <select id="budget" class="input-field">
                            <option value="">è¯·é€‰æ‹©é¢„ç®—</option>
                            <option value="ç»æµå‹">ç»æµå‹ (Â¥500-1000/å¤©)</option>
                            <option value="ä¸­ç­‰" selected>ä¸­ç­‰ (Â¥1000-3000/å¤©)</option>
                            <option value="èˆ’é€‚">èˆ’é€‚ (Â¥3000-6000/å¤©)</option>
                            <option value="è±ªå">è±ªå (Â¥6000+/å¤©)</option>
                        </select>
                    </div>

                    <!-- æ—…è¡Œé£æ ¼ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-palette mr-1"></i>
                            æ—…è¡Œé£æ ¼
                        </label>
                        <select id="travelStyle" class="input-field">
                            <option value="adventure">å†’é™©åˆºæ¿€</option>
                            <option value="relaxed">ä¼‘é—²æ”¾æ¾</option>
                            <option value="cultural" selected>æ–‡åŒ–æ¢ç´¢</option>
                            <option value="nature">è‡ªç„¶é£å…‰</option>
                            <option value="urban">åŸå¸‚è§‚å…‰</option>
                        </select>
                    </div>

                    <!-- äººæ•° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-users mr-1"></i>
                            æ—…è¡Œäººæ•°
                        </label>
                        <select id="groupSize" class="input-field">
                            <option value="1">ç‹¬è‡ªæ—…è¡Œ</option>
                            <option value="2" selected>æƒ…ä¾£/å¤«å¦»</option>
                            <option value="3">3äºº</option>
                            <option value="4">4äºº</option>
                            <option value="5">5äººåŠä»¥ä¸Š</option>
                        </select>
                    </div>

                    <!-- å…´è¶£çˆ±å¥½ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            å…´è¶£çˆ±å¥½
                        </label>
                        <div class="flex flex-wrap gap-2 mb-3" id="interestsContainer">
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="å†å²æ–‡åŒ–">å†å²æ–‡åŒ–</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="è‡ªç„¶é£å…‰">è‡ªç„¶é£å…‰</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="ç¾é£Ÿä½“éªŒ">ç¾é£Ÿä½“éªŒ</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="è´­ç‰©">è´­ç‰©</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="å†’é™©è¿åŠ¨">å†’é™©è¿åŠ¨</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="è‰ºæœ¯åšç‰©é¦†">è‰ºæœ¯åšç‰©é¦†</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="å¤œç”Ÿæ´»">å¤œç”Ÿæ´»</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="æµ·æ»©åº¦å‡">æµ·æ»©åº¦å‡</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="å±±åœ°å¾’æ­¥">å±±åœ°å¾’æ­¥</button>
                            <button class="interest-btn px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" data-interest="æ‘„å½±">æ‘„å½±</button>
                        </div>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <button onclick="generatePlan()" id="generateBtn" class="w-full btn-primary" disabled>
                        <i class="fas fa-rocket mr-2"></i>
                        <span id="btnText">è¯·å…ˆé…ç½®APIä¿¡æ¯</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- æ—…è¡Œè®¡åˆ’å±•ç¤º -->
        <div id="planDisplay" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- å·¦ä¾§ï¼šè¡Œç¨‹è¯¦æƒ… -->
                <div class="lg:col-span-2">
                    <div class="card p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h2 id="planTitle" class="text-3xl font-bold text-gray-900 mb-2">æ—…è¡Œè®¡åˆ’</h2>
                                <p id="planSubtitle" class="text-gray-600">æ—…è¡Œä¿¡æ¯</p>
                            </div>
                            <button onclick="backToForm()" class="px-4 py-2 border-2 border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors">
                                <i class="fas fa-edit mr-2"></i>
                                é‡æ–°è§„åˆ’
                            </button>
                        </div>
                        <div id="planInterests" class="flex flex-wrap gap-2"></div>
                    </div>

                    <div id="itineraryContainer" class="space-y-4">
                        <!-- è¡Œç¨‹å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- å³ä¾§ï¼šèŠå¤©ç•Œé¢ -->
                <div class="lg:col-span-1">
                    <div class="card h-[600px] flex flex-col">
                        <!-- Chat Header -->
                        <div class="p-4 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="gradient-bg p-2 rounded-lg">
                                        <i class="fas fa-comments text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">AIæ—…è¡ŒåŠ©æ‰‹</h3>
                                        <p class="text-xs text-gray-500 flex items-center">
                                            <span id="apiStatus" class="flex items-center">
                                                <span class="w-2 h-2 bg-gray-400 rounded-full mr-1"></span>
                                                æœªé…ç½®
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <button onclick="testConnection()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded transition-colors">
                                    <i class="fas fa-sync-alt mr-1"></i>
                                    æµ‹è¯•
                                </button>
                            </div>
                        </div>

                        <!-- Messages Area -->
                        <div id="messagesArea" class="flex-1 overflow-y-auto p-4 space-y-4">
                            <div class="text-center py-8">
                                <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-robot text-2xl text-gray-400"></i>
                                </div>
                                <h4 class="font-medium text-gray-900 mb-2">AIåŠ©æ‰‹å°±ç»ª</h4>
                                <p class="text-sm text-gray-600 mb-6">
                                    é…ç½®APIåå³å¯å¼€å§‹æ™ºèƒ½å¯¹è¯
                                </p>
                                
                                <!-- Quick Suggestions -->
                                <div class="space-y-2">
                                    <p class="text-xs text-gray-500 font-medium">å¿«é€Ÿå»ºè®®ï¼š</p>
                                    <div class="flex flex-wrap gap-2 justify-center">
                                        <button onclick="sendQuickMessage('è°ƒæ•´ç¬¬äºŒå¤©çš„è¡Œç¨‹å®‰æ’')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors">è°ƒæ•´ç¬¬äºŒå¤©è¡Œç¨‹</button>
                                        <button onclick="sendQuickMessage('æ¨èæ›´å¤šå½“åœ°ç¾é£Ÿ')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors">æ¨èæ›´å¤šç¾é£Ÿ</button>
                                        <button onclick="sendQuickMessage('å¢åŠ è´­ç‰©æ—¶é—´')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors">å¢åŠ è´­ç‰©æ—¶é—´</button>
                                        <button onclick="sendQuickMessage('å‡å°‘é¢„ç®—æ”¯å‡º')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors">å‡å°‘é¢„ç®—æ”¯å‡º</button>
                                        <button onclick="sendQuickMessage('æ·»åŠ æ›´å¤šæˆ·å¤–æ´»åŠ¨')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors">æ·»åŠ æˆ·å¤–æ´»åŠ¨</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div class="p-4 border-t border-gray-100">
                            <div class="flex space-x-2">
                                <input type="text" id="chatInput" placeholder="æè¿°æ‚¨æƒ³è¦çš„è°ƒæ•´..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" disabled>
                                <button onclick="sendMessage()" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50" id="sendBtn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center items-center space-x-2 mb-4">
                <i class="fas fa-compass text-2xl"></i>
                <span class="text-xl font-bold">AIæ—…æ¸¸æ”»ç•¥å¹³å°</span>
            </div>
            <p class="text-gray-400 text-sm mb-4">æ™ºèƒ½è§„åˆ’æ‚¨çš„å®Œç¾æ—…ç¨‹</p>
            <div class="flex justify-center space-x-4 text-sm text-gray-400">
                <span><i class="fas fa-code mr-1"></i>AIé©±åŠ¨</span>
                <span><i class="fas fa-shield-alt mr-1"></i>å®‰å…¨å¯é </span>
                <span><i class="fas fa-cloud mr-1"></i>äº‘ç«¯éƒ¨ç½²</span>
            </div>
            <p class="text-xs text-gray-500 mt-4">Â© 2024 AIæ—…æ¸¸æ”»ç•¥å¹³å°. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentPlan = null;
        let selectedInterests = [];
        let chatMessages = [];
        let isTyping = false;
        let apiConfig = null;
        
        // å®‰å…¨é…ç½®ç®¡ç†
        class SecureConfig {
            static save(config) {
                try {
                    const encrypted = btoa(JSON.stringify(config));
                    localStorage.setItem('travel_planner_config', encrypted);
                } catch (e) {
                    console.error('é…ç½®ä¿å­˜å¤±è´¥:', e);
                }
            }
            
            static load() {
                try {
                    const encrypted = localStorage.getItem('travel_planner_config');
                    if (!encrypted) return null;
                    return JSON.parse(atob(encrypted));
                } catch (e) {
                    console.error('é…ç½®åŠ è½½å¤±è´¥:', e);
                    return null;
                }
            }
            
            static clear() {
                localStorage.removeItem('travel_planner_config');
            }
        }

        // åˆå§‹åŒ–é…ç½®
        function initConfig() {
            apiConfig = SecureConfig.load();
            if (apiConfig) {
                document.getElementById('apiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                document.getElementById('apiUrl').value = apiConfig.url;
                document.getElementById('modelName').value = apiConfig.model;
                enableGenerateButton();
                updateAPIStatus('disconnected');
            }
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const modelName = document.getElementById('modelName').value.trim();
            
            if (!apiKey || apiKey === 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢') {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥', 'error');
                return;
            }
            
            apiConfig = {
                key: apiKey,
                url: apiUrl,
                model: modelName,
                temperature: 0.7,
                maxTokens: 500
            };
            
            SecureConfig.save(apiConfig);
            
            // éšè—å¯†é’¥
            document.getElementById('apiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            
            enableGenerateButton();
            updateAPIStatus('disconnected');
            showNotification('APIé…ç½®å·²ä¿å­˜', 'success');
            
            // è‡ªåŠ¨æµ‹è¯•è¿æ¥
            setTimeout(testConnection, 500);
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} mr-2"></i>
                ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // å¯ç”¨ç”ŸæˆæŒ‰é’®
        function enableGenerateButton() {
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            btn.disabled = false;
            btnText.innerHTML = '<i class="fas fa-rocket mr-2"></i>ç”Ÿæˆæ—…è¡Œè®¡åˆ’';
            
            // å¯ç”¨èŠå¤©è¾“å…¥
            document.getElementById('chatInput').disabled = false;
            document.getElementById('sendBtn').disabled = false;
        }

        // æ›´æ–°APIçŠ¶æ€
        function updateAPIStatus(status) {
            const statusElement = document.getElementById('apiStatus');
            const statusColors = {
                'connected': 'bg-green-500',
                'disconnected': 'bg-red-500',
                'connecting': 'bg-yellow-500 animate-pulse',
                'error': 'bg-red-500 animate-pulse'
            };
            
            const statusMessages = {
                'connected': 'å·²è¿æ¥',
                'disconnected': 'æœªè¿æ¥',
                'connecting': 'è¿æ¥ä¸­...',
                'error': 'è¿æ¥é”™è¯¯'
            };
            
            statusElement.innerHTML = `
                <span class="w-2 h-2 ${statusColors[status]} rounded-full mr-1"></span>
                ${statusMessages[status]}
            `;
        }

        // æµ‹è¯•APIè¿æ¥
        async function testConnection() {
            if (!apiConfig) {
                showNotification('è¯·å…ˆé…ç½®APIä¿¡æ¯', 'error');
                return;
            }
            
            updateAPIStatus('connecting');
            
            try {
                const testResponse = await fetch(apiConfig.url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiConfig.key}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'TravelPlanner-Online/1.0.0',
                        'Host': 'mgw.proxy.ksyun.com',
                        'Connection': 'keep-alive',
                        'Accept': '*/*'
                    },
                    body: JSON.stringify({
                        model: apiConfig.model,
                        messages: [
                            {
                                role: 'user',
                                content: 'ä½ å¥½ï¼Œè¯·ç®€å•å›å¤"è¿æ¥æˆåŠŸ"'
                            }
                        ],
                        temperature: 0.1,
                        max_tokens: 50
                    })
                });
                
                if (testResponse.ok) {
                    const data = await testResponse.json();
                    console.log('APIè¿æ¥æˆåŠŸ:', data.choices[0].message.content);
                    updateAPIStatus('connected');
                    showNotification('APIè¿æ¥æˆåŠŸ', 'success');
                    return true;
                } else {
                    console.error('APIè¿æ¥å¤±è´¥:', testResponse.status, testResponse.statusText);
                    updateAPIStatus('error');
                    showNotification(`APIè¿æ¥å¤±è´¥: ${testResponse.status}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('APIæµ‹è¯•é”™è¯¯:', error);
                updateAPIStatus('error');
                showNotification(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é…ç½®
            initConfig();
            
            // å¤©æ•°æ»‘å—
            const durationSlider = document.getElementById('duration');
            const durationDisplay = document.getElementById('durationDisplay');
            durationSlider.addEventListener('input', function() {
                durationDisplay.textContent = this.value + 'å¤©';
            });

            // å…´è¶£çˆ±å¥½æŒ‰é’®
            document.querySelectorAll('.interest-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const interest = this.dataset.interest;
                    if (selectedInterests.includes(interest)) {
                        selectedInterests = selectedInterests.filter(i => i !== interest);
                        this.classList.remove('bg-blue-600', 'text-white');
                        this.classList.add('bg-gray-100', 'text-gray-700');
                    } else {
                        selectedInterests.push(interest);
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-blue-600', 'text-white');
                    }
                });
            });

            // èŠå¤©è¾“å…¥æ¡†å›è½¦å‘é€
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

        // ç”Ÿæˆæ—…è¡Œè®¡åˆ’
        async function generatePlan() {
            const destination = document.getElementById('destination').value.trim();
            const duration = parseInt(document.getElementById('duration').value);
            const budget = document.getElementById('budget').value || 'ä¸­ç­‰';
            const travelStyle = document.getElementById('travelStyle').value;

            if (!destination) {
                showNotification('è¯·å¡«å†™ç›®çš„åœ°', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            btn.disabled = true;
            btnText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸“å±æ—…è¡Œè®¡åˆ’...';

            // æ¨¡æ‹Ÿç”Ÿæˆå»¶è¿Ÿ
            await sleep(2000);

            // ç”Ÿæˆè®¡åˆ’æ•°æ®
            currentPlan = {
                destination,
                duration,
                budget,
                travelStyle,
                interests: selectedInterests,
                itinerary: generateMockItinerary(destination, duration, selectedInterests)
            };

            // æ˜¾ç¤ºè®¡åˆ’
            displayPlan(currentPlan);

            // æ¢å¤æŒ‰é’®çŠ¶æ€
            btn.disabled = false;
            btnText.innerHTML = '<i class="fas fa-rocket mr-2"></i>ç”Ÿæˆæ—…è¡Œè®¡åˆ’';
            showNotification('æ—…è¡Œè®¡åˆ’ç”ŸæˆæˆåŠŸï¼', 'success');
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿè¡Œç¨‹
        function generateMockItinerary(dest, days, interests) {
            const itinerary = [];
            
            for (let day = 1; day <= days; day++) {
                const activities = [
                    {
                        id: `${day}-1`,
                        name: `${dest}ç»å…¸æ™¯ç‚¹å‚è§‚`,
                        description: `æ¢ç´¢${dest}æœ€è‘—åçš„æ™¯ç‚¹ï¼Œäº†è§£å½“åœ°æ–‡åŒ–å’Œå†å²`,
                        duration: 3,
                        cost: 'å…è´¹',
                        location: `${dest}å¸‚ä¸­å¿ƒ`,
                        category: 'sightseeing',
                        rating: 4.5
                    },
                    {
                        id: `${day}-2`,
                        name: 'å½“åœ°ç‰¹è‰²ç¾é£Ÿå“å°',
                        description: 'å“å°åœ°é“çš„å½“åœ°ç¾é£Ÿï¼Œä½“éªŒæ­£å®—é£å‘³',
                        duration: 2,
                        cost: 'Â¥100-200',
                        location: `${dest}è€åŸåŒº`,
                        category: 'culture',
                        rating: 4.8
                    }
                ];

                if (interests.includes('è´­ç‰©')) {
                    activities.push({
                        id: `${day}-3`,
                        name: 'ç‰¹è‰²è¡—åŒºè´­ç‰©',
                        description: 'é€›å½“åœ°ç‰¹è‰²å•†åº—ï¼Œè´­ä¹°çºªå¿µå“å’Œç‰¹äº§',
                        duration: 2,
                        cost: 'Â¥200-500',
                        location: `${dest}å•†ä¸šåŒº`,
                        category: 'shopping',
                        rating: 4.2
                    });
                }

                const meals = [
                    {
                        type: 'breakfast',
                        name: 'å½“åœ°ç‰¹è‰²æ—©é¤',
                        cuisine: 'æœ¬åœ°èœ',
                        location: 'é…’åº—é™„è¿‘',
                        cost: 'Â¥30-50',
                        rating: 4.3
                    },
                    {
                        type: 'lunch',
                        name: 'ç‰¹è‰²é¤å…åˆé¤',
                        cuisine: 'æœ¬åœ°èœ',
                        location: 'æ™¯åŒºé™„è¿‘',
                        cost: 'Â¥80-120',
                        rating: 4.6
                    },
                    {
                        type: 'dinner',
                        name: 'æ™¯è§‚é¤å…æ™šé¤',
                        cuisine: 'èåˆèœ',
                        location: 'å¸‚ä¸­å¿ƒ',
                        cost: 'Â¥150-300',
                        rating: 4.7
                    }
                ];

                itinerary.push({
                    day,
                    activities,
                    meals,
                    accommodation: {
                        name: `${dest}ç²¾å“é…’åº—`,
                        type: 'hotel',
                        location: `${dest}å¸‚ä¸­å¿ƒ`,
                        rating: 4.5,
                        cost: 'Â¥300-600/æ™š',
                        amenities: ['WiFi', 'ç©ºè°ƒ', 'æ—©é¤', 'å¥èº«æˆ¿']
                    }
                });
            }

            return itinerary;
        }

        // æ˜¾ç¤ºæ—…è¡Œè®¡åˆ’
        function displayPlan(plan) {
            document.getElementById('initialForm').classList.add('hidden');
            document.getElementById('planDisplay').classList.remove('hidden');

            // æ›´æ–°è®¡åˆ’æ ‡é¢˜
            document.getElementById('planTitle').textContent = `${plan.destination}ä¹‹æ—…`;
            document.getElementById('planSubtitle').textContent = `${plan.duration}å¤© Â· ${getTravelStyleText(plan.travelStyle)} Â· ${plan.budget}é¢„ç®—`;

            // æ˜¾ç¤ºå…´è¶£çˆ±å¥½
            const interestsContainer = document.getElementById('planInterests');
            interestsContainer.innerHTML = '';
            plan.interests.forEach(interest => {
                const span = document.createElement('span');
                span.className = 'px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm';
                span.textContent = interest;
                interestsContainer.appendChild(span);
            });

            // ç”Ÿæˆè¡Œç¨‹å†…å®¹
            const itineraryContainer = document.getElementById('itineraryContainer');
            itineraryContainer.innerHTML = '<h3 class="text-xl font-bold text-gray-900 mb-4">æ¯æ—¥è¡Œç¨‹</h3>';

            plan.itinerary.forEach(dayPlan => {
                const dayCard = document.createElement('div');
                dayCard.className = 'card';
                dayCard.innerHTML = `
                    <div class="p-6 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleDay(${dayPlan.day})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold">
                                    ${dayPlan.day}
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">ç¬¬${dayPlan.day}å¤©</h4>
                                    <p class="text-sm text-gray-600">${dayPlan.activities.length}ä¸ªæ´»åŠ¨ Â· ${dayPlan.meals.length}é¤</p>
                                </div>
                            </div>
                            <i id="chevron-${dayPlan.day}" class="fas fa-chevron-down text-gray-400"></i>
                        </div>
                    </div>
                    <div id="day-content-${dayPlan.day}" class="hidden p-6 space-y-6">
                        ${generateDayContent(dayPlan)}
                    </div>
                `;
                itineraryContainer.appendChild(dayCard);
            });

            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ç”Ÿæˆå•æ—¥å†…å®¹
        function generateDayContent(dayPlan) {
            let content = '';

            // æ´»åŠ¨å®‰æ’
            content += `
                <div>
                    <h5 class="font-semibold text-gray-900 mb-3">
                        <i class="fas fa-camera mr-2"></i>æ´»åŠ¨å®‰æ’
                    </h5>
                    <div class="space-y-3">
                        ${dayPlan.activities.map(activity => `
                            <div class="activity-card flex items-start space-x-3">
                                <div class="p-2 rounded-lg bg-blue-100 text-blue-700">
                                    ${getCategoryIcon(activity.category)}
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h6 class="font-medium text-gray-900">${activity.name}</h6>
                                        <button onclick="toggleLike('${activity.id}')" class="text-gray-400 hover:text-red-500 transition-colors">
                                            <i id="like-${activity.id}" class="far fa-heart"></i>
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-2">${activity.description}</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-clock mr-1"></i>${activity.duration}å°æ—¶</span>
                                        <span><i class="fas fa-map-marker-alt mr-1"></i>${activity.location}</span>
                                        <span><i class="fas fa-dollar-sign mr-1"></i>${activity.cost}</span>
                                        <span><i class="fas fa-star mr-1 text-yellow-400"></i>${activity.rating}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // ç¾é£Ÿå®‰æ’
            content += `
                <div>
                    <h5 class="font-semibold text-gray-900 mb-3">
                        <i class="fas fa-utensils mr-2"></i>ç¾é£Ÿå®‰æ’
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        ${dayPlan.meals.map(meal => `
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">
                                        ${meal.type === 'breakfast' ? 'æ—©é¤' : meal.type === 'lunch' ? 'åˆé¤' : 'æ™šé¤'}
                                    </span>
                                    <span class="text-xs text-yellow-600">
                                        <i class="fas fa-star text-yellow-400 mr-1"></i>${meal.rating}
                                    </span>
                                </div>
                                <h6 class="font-medium text-gray-900">${meal.name}</h6>
                                <p class="text-sm text-gray-600">${meal.cuisine}</p>
                                <div class="flex items-center justify-between mt-2 text-sm text-gray-500">
                                    <span><i class="fas fa-map-marker-alt mr-1"></i>${meal.location}</span>
                                    <span>${meal.cost}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // ä½å®¿
            if (dayPlan.accommodation) {
                content += `
                    <div>
                        <h5 class="font-semibold text-gray-900 mb-3">
                            <i class="fas fa-bed mr-2"></i>ä½å®¿
                        </h5>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h6 class="font-medium text-gray-900">${dayPlan.accommodation.name}</h6>
                                <span class="text-sm text-yellow-600">
                                    <i class="fas fa-star text-yellow-400 mr-1"></i>${dayPlan.accommodation.rating}
                                </span>
                            </div>
                            <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                <span>é…’åº—</span>
                                <span>${dayPlan.accommodation.location}</span>
                                <span>${dayPlan.accommodation.cost}</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                ${dayPlan.accommodation.amenities.map(amenity => `
                                    <span class="text-xs bg-white px-2 py-1 rounded text-gray-600">${amenity}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            return content;
        }

        // è°ƒç”¨çœŸå®AI APIï¼ˆå®‰å…¨ç‰ˆæœ¬ï¼‰
        async function callAI(userMessage) {
            if (!currentPlan) {
                return 'è¯·å…ˆç”Ÿæˆæ—…è¡Œè®¡åˆ’ï¼Œç„¶åæˆ‘å°±å¯ä»¥ä¸ºæ‚¨æä¾›ä¸ªæ€§åŒ–çš„è°ƒæ•´å»ºè®®äº†ï¼';
            }

            if (!apiConfig) {
                return 'è¯·å…ˆé…ç½®APIä¿¡æ¯ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨AIæ™ºèƒ½åŠ©æ‰‹äº†ã€‚';
            }

            updateAPIStatus('connecting');
            
            const messages = [
                {
                    role: 'system',
                    content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIæ—…è¡ŒåŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·åˆ¶å®šå’Œè°ƒæ•´æ—…è¡Œè®¡åˆ’ã€‚å½“å‰ç”¨æˆ·æ­£åœ¨è§„åˆ’${currentPlan.destination}çš„${currentPlan.duration}å¤©æ—…è¡Œï¼Œé¢„ç®—${currentPlan.budget}ï¼Œæ—…è¡Œé£æ ¼${currentPlan.travelStyle}ã€‚

è¯·æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚æä¾›ï¼š
1. ä¸“ä¸šçš„æ—…è¡Œå»ºè®®å’Œè°ƒæ•´æ–¹æ¡ˆ
2. å…·ä½“çš„è¡Œç¨‹å®‰æ’å»ºè®®
3. è€ƒè™‘ç”¨æˆ·çš„å…´è¶£çˆ±å¥½ï¼š${currentPlan.interests.join('ã€') || 'æš‚æ— ç‰¹å®šå…´è¶£'}
4. å‹å¥½ã€ä¸“ä¸šçš„å›å¤é£æ ¼
5. å®ç”¨çš„å»ºè®®å’Œå…·ä½“çš„ä¿¡æ¯

å¦‚æœç”¨æˆ·è¦æ±‚è°ƒæ•´è®¡åˆ’ï¼Œè¯·æ˜ç¡®æå‡ºä½ å°†å¦‚ä½•ä¼˜åŒ–è¡Œç¨‹ã€‚å›å¤è¦å…·ä½“ã€æœ‰ç”¨ã€ä¸ªæ€§åŒ–ã€‚`
                },
                {
                    role: 'user',
                    content: userMessage
                }
            ];

            try {
                const response = await fetch(apiConfig.url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiConfig.key}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'TravelPlanner-Online/1.0.0',
                        'Host': 'mgw.proxy.ksyun.com',
                        'Connection': 'keep-alive',
                        'Accept': '*/*'
                    },
                    body: JSON.stringify({
                        model: apiConfig.model,
                        messages: messages,
                        temperature: apiConfig.temperature,
                        max_tokens: apiConfig.maxTokens
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                updateAPIStatus('connected');
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
                updateAPIStatus('error');
                
                return `æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼ˆ${error.message}ï¼‰ã€‚ä¸è¿‡æˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ä¸€äº›åŸºç¡€çš„æ—…è¡Œå»ºè®®ï¼š

${userMessage.includes('ç¾é£Ÿ') ? 'ğŸœ å»ºè®®æ‚¨å°è¯•å½“åœ°ç‰¹è‰²ç¾é£Ÿï¼Œå¯ä»¥å»å½“åœ°çš„ç½‘çº¢é¤å…æˆ–è€å­—å·åº—é“ºã€‚' : ''}
${userMessage.includes('è´­ç‰©') ? 'ğŸ›ï¸ æ¨èæ‚¨å»å½“åœ°çš„å•†ä¸šè¡—æˆ–ç‰¹äº§åº—ï¼Œè´­ä¹°ä¸€äº›çºªå¿µå“å’Œå½“åœ°ç‰¹äº§ã€‚' : ''}
${userMessage.includes('é¢„ç®—') ? 'ğŸ’° å»ºè®®é€‰æ‹©æ€§ä»·æ¯”é«˜çš„ä½å®¿å’Œé¤å…ï¼Œå¤šåˆ©ç”¨å…¬å…±äº¤é€šå·¥å…·ã€‚' : ''}
${userMessage.includes('è°ƒæ•´') ? 'ğŸ“ æˆ‘å¯ä»¥æ ¹æ®æ‚¨çš„éœ€æ±‚è°ƒæ•´è¡Œç¨‹å®‰æ’ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“æƒ³è°ƒæ•´å“ªäº›éƒ¨åˆ†ã€‚' : 'ğŸ“‹ å¦‚æœæ‚¨æœ‰å…¶ä»–éœ€æ±‚ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ï¼'}`;
            }
        }

        // ç”ŸæˆAIå›å¤
        async function generateAIResponse(userInput) {
            // è°ƒç”¨çœŸå®AI API
            const aiResponse = await callAI(userInput);
            
            // æ ¹æ®å›å¤å†…å®¹åˆ¤æ–­ç±»å‹
            const lowerResponse = aiResponse.toLowerCase();
            const lowerInput = userInput.toLowerCase();
            
            let responseType = 'text';
            
            if (lowerInput.includes('è°ƒæ•´') || lowerInput.includes('ä¿®æ”¹') || lowerInput.includes('æ”¹å˜') ||
                lowerInput.includes('é‡æ–°å®‰æ’') || lowerInput.includes('æ›´æ–°') ||
                lowerResponse.includes('è°ƒæ•´') || lowerResponse.includes('é‡æ–°å®‰æ’') || 
                lowerResponse.includes('ä¼˜åŒ–è¡Œç¨‹') || lowerResponse.includes('æ›´æ–°è®¡åˆ’')) {
                responseType = 'plan_update';
            }
            
            if (lowerInput.includes('ç¾é£Ÿ') || lowerInput.includes('åƒ') || lowerInput.includes('é¤å…') ||
                lowerResponse.includes('ç¾é£Ÿ') || lowerResponse.includes('é¤å…') || lowerResponse.includes('æ¨è')) {
                responseType = 'suggestion';
            }
            
            if (lowerInput.includes('è´­ç‰©') || lowerInput.includes('ä¹°') || lowerInput.includes('å•†åº—')) {
                responseType = 'suggestion';
            }
            
            if (lowerInput.includes('é¢„ç®—') || lowerInput.includes('èŠ±è´¹') || lowerInput.includes('ä¾¿å®œ')) {
                responseType = 'plan_update';
            }
            
            return {
                text: aiResponse,
                type: responseType
            };
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            input.value = '';
            await addMessage(message, 'user');
            showTyping();
            
            // è°ƒç”¨çœŸå®AI
            const response = await generateAIResponse(message);
            hideTyping();
            await addMessage(response.text, response.type === 'plan_update' ? 'assistant-update' : 'assistant');
            
            // å¦‚æœéœ€è¦æ›´æ–°è®¡åˆ’
            if (response.type === 'plan_update') {
                setTimeout(() => {
                    updatePlan(message, response.text);
                }, 2000);
            }
        }

        // å¿«é€Ÿæ¶ˆæ¯
        async function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            await sendMessage();
        }

        // æ·»åŠ æ¶ˆæ¯
        async function addMessage(text, type) {
            const messagesArea = document.getElementById('messagesArea');
            const isUser = type === 'user';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            messageDiv.innerHTML = `
                <div class="message-bubble ${isUser ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-900'}">
                    <div class="flex items-start space-x-2">
                        <div class="flex-shrink-0 mt-0.5">
                            <i class="fas fa-${isUser ? 'user' : 'robot'} text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">${text}</p>
                            ${type === 'assistant-update' ? `
                                <div class="mt-2 flex items-center space-x-2">
                                    <i class="fas fa-sync-alt text-xs"></i>
                                    <span class="text-xs opacity-75">è®¡åˆ’æ­£åœ¨æ›´æ–°...</span>
                                </div>
                            ` : ''}
                            <div class="mt-2 text-xs opacity-75">
                                ${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            
            await sleep(100);
        }

        // æ˜¾ç¤ºæ‰“å­—åŠ¨ç”»
        function showTyping() {
            isTyping = true;
            const messagesArea = document.getElementById('messagesArea');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'flex justify-start';
            typingDiv.innerHTML = `
                <div class="message-bubble bg-gray-100 text-gray-900">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-robot text-sm"></i>
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            messagesArea.appendChild(typingDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // éšè—æ‰“å­—åŠ¨ç”»
        function hideTyping() {
            isTyping = false;
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // æ›´æ–°è®¡åˆ’ï¼ˆåŸºäºAIå›å¤ï¼‰
        async function updatePlan(userInput, aiResponse) {
            const lowerInput = userInput.toLowerCase();
            const lowerResponse = aiResponse.toLowerCase();
            
            // æ ¹æ®ç”¨æˆ·è¾“å…¥å’ŒAIå›å¤æ›´æ–°å…´è¶£
            if (lowerInput.includes('ç¾é£Ÿ') || lowerInput.includes('åƒ') || 
                lowerResponse.includes('ç¾é£Ÿ') || lowerResponse.includes('é¤å…')) {
                if (!currentPlan.interests.includes('ç¾é£Ÿä½“éªŒ')) {
                    currentPlan.interests.push('ç¾é£Ÿä½“éªŒ');
                }
            }
            
            if (lowerInput.includes('è´­ç‰©') || lowerInput.includes('ä¹°') ||
                lowerResponse.includes('è´­ç‰©') || lowerResponse.includes('å•†åº—')) {
                if (!currentPlan.interests.includes('è´­ç‰©')) {
                    currentPlan.interests.push('è´­ç‰©');
                }
            }
            
            // é¢„ç®—è°ƒæ•´
            if (lowerInput.includes('é¢„ç®—') || lowerInput.includes('ä¾¿å®œ') || lowerInput.includes('ç»æµ') ||
                lowerResponse.includes('é¢„ç®—') || lowerResponse.includes('èŠ‚çœ') || lowerResponse.includes('ç»æµ')) {
                currentPlan.budget = 'ç»æµå‹';
            }
            
            if (lowerInput.includes('è±ªå') || lowerInput.includes('é«˜ç«¯') || lowerInput.includes('å¥¢ä¾ˆ') ||
                lowerResponse.includes('è±ªå') || lowerResponse.includes('é«˜ç«¯')) {
                currentPlan.budget = 'è±ªå';
            }
            
            // é‡æ–°ç”Ÿæˆè¡Œç¨‹
            await addMessage('ğŸ”„ æ­£åœ¨æ ¹æ®AIå»ºè®®é‡æ–°ç”Ÿæˆä¸ªæ€§åŒ–è¡Œç¨‹...', 'assistant');
            currentPlan.itinerary = generateMockItinerary(currentPlan.destination, currentPlan.duration, currentPlan.interests);
            
            setTimeout(() => {
                displayPlan(currentPlan);
                addMessage('âœ… æ—…è¡Œè®¡åˆ’å·²æ ¹æ®AIæ™ºèƒ½å»ºè®®æ›´æ–°å®Œæˆï¼è¯·æŸ¥çœ‹å·¦ä¾§çš„æœ€æ–°è¡Œç¨‹å®‰æ’ã€‚', 'assistant');
            }, 1000);
        }

        // å·¥å…·å‡½æ•°
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function getTravelStyleText(style) {
            const styles = {
                'adventure': 'å†’é™©åˆºæ¿€',
                'relaxed': 'ä¼‘é—²æ”¾æ¾',
                'cultural': 'æ–‡åŒ–æ¢ç´¢',
                'nature': 'è‡ªç„¶é£å…‰',
                'urban': 'åŸå¸‚è§‚å…‰'
            };
            return styles[style] || style;
        }

        function getCategoryIcon(category) {
            const icons = {
                'sightseeing': '<i class="fas fa-camera"></i>',
                'shopping': '<i class="fas fa-shopping-bag"></i>',
                'culture': '<i class="fas fa-landmark"></i>',
                'adventure': '<i class="fas fa-hiking"></i>',
                'relaxation': '<i class="fas fa-umbrella-beach"></i>',
                'entertainment': '<i class="fas fa-music"></i>'
            };
            return icons[category] || '<i class="fas fa-map-marker-alt"></i>';
        }

        // åˆ‡æ¢å¤©æ•°å±•å¼€/æ”¶èµ·
        function toggleDay(day) {
            const content = document.getElementById(`day-content-${day}`);
            const chevron = document.getElementById(`chevron-${day}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
            } else {
                content.classList.add('hidden');
                chevron.classList.remove('fa-chevron-up');
                chevron.classList.add('fa-chevron-down');
            }
        }

        // åˆ‡æ¢æ”¶è—
        function toggleLike(activityId) {
            const heartIcon = document.getElementById(`like-${activityId}`);
            if (heartIcon.classList.contains('far')) {
                heartIcon.classList.remove('far');
                heartIcon.classList.add('fas', 'text-red-500');
            } else {
                heartIcon.classList.remove('fas', 'text-red-500');
                heartIcon.classList.add('far');
            }
        }

        // è¿”å›è¡¨å•
        function backToForm() {
            document.getElementById('planDisplay').classList.add('hidden');
            document.getElementById('initialForm').classList.remove('hidden');
            chatMessages = [];
        }

        // æ·»åŠ é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', function() {
            console.log('ğŸŒ AIæ—…æ¸¸æ”»ç•¥å¹³å°å·²åŠ è½½å®Œæˆ');
            console.log('ğŸ“± ç‰ˆæœ¬: åœ¨çº¿éƒ¨ç½²ç‰ˆ');
            console.log('ğŸ›¡ï¸ å®‰å…¨: æœ¬åœ°å­˜å‚¨APIé…ç½®');
        });
    </script>
</body>
</html>